<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>PropertyWize ‚Ä¢ Decision Tool 2.0 (Clean Fix)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Minimal styles only to preserve your current look; adjust tokens to your theme if needed -->
<style>
  :root{ --card-bg:#fff; --line:#e8eef4; --muted:#657081; --ink:#101828; --btn:#eef2f6; --btn-ink:#1f2937; --btn-primary:#2563eb; --btn-primary-ink:#fff; --radius:10px; }
  body{ font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif; color:var(--ink); margin:0; background:#f7f9fc;}
  .container{ max-width:1100px; margin:28px auto; padding:0 16px;}
  .pillnav{ width:260px; float:left; }
  .main{ margin-left:290px;}
  .card{ background:var(--card-bg); border:1px solid var(--line); border-radius:var(--radius); padding:16px; margin:14px 0;}
  .hr{ height:1px; background:var(--line); margin:12px 0;}
  .note{ color:var(--muted); margin-top:0;}
  .row{ display:flex; align-items:center; flex-wrap:wrap;}
  .two-col{ display:grid; grid-template-columns:1fr 1fr; gap:12px;}
  .field{ display:block; margin:8px 0;}
  .field label{ display:block; font-size:14px; margin-bottom:6px;}
  input[type="text"], input[type="number"], textarea, select{
    width:100%; box-sizing:border-box; border:1px solid var(--line); border-radius:8px; padding:10px 12px; background:#fff; color:var(--ink);
  }
  textarea{ min-height:130px; }
  .btn{ background:var(--btn); color:var(--btn-ink); border:1px solid var(--line); border-radius:8px; padding:8px 12px; cursor:pointer;}
  .btn.primary{ background:var(--btn-primary); color:var(--btn-primary-ink); border-color:var(--btn-primary);}
  .btn:disabled{ opacity:.6; cursor:not-allowed;}
  .hidden{ display:none !important; }
  /* left nav (just placeholder to resemble your layout) */
  .pill{ background:#fff; border:1px solid var(--line); border-radius:999px; padding:10px 14px; margin:8px 0; display:flex; align-items:center; gap:10px; cursor:pointer;}
  .pill.active{ outline:2px solid #dbeafe; background:#f8fbff;}
  .progress{ height:8px; background:#e6edf6; border-radius:8px; overflow:hidden;}
  .progress > div{ height:100%; background:#60a5fa; width:6%;}
</style>
</head>
<body>

<div class="container">
  <!-- LEFT NAV (static for this sample) -->
  <div class="pillnav">
    <div class="pill active" data-view="maintenance">üõ†Ô∏è Maintenance</div>
    <div class="pill" data-view="finance">üíµ Finance</div>
    <div class="pill" data-view="nonmaint">üìÑ Non-Maintenance Bill</div>
    <div class="pill" data-view="delinquency">üßæ Delinquency</div>
    <div class="pill" data-view="stale">üìâ Stale Listing</div>
    <div class="pill" data-view="appliance">üîå Appliance</div>

    <div class="card" style="margin-top:12px;">
      <div class="row" style="gap:8px; justify-content:space-between">
        <button class="btn" id="btnResetAll">Reset</button>
        <button class="btn">Print / Save PDF</button>
      </div>
      <div class="hr"></div>
      <button class="btn" id="btnOwnerPlans">Manage Owner Plans</button>
      <div class="hr"></div>
      <div class="progress"><div></div></div>
    </div>
  </div>

  <!-- MAIN -->
  <div class="main">

    <!-- ===== Maintenance ===== -->
    <section class="card" id="view-maintenance" data-view="maintenance">
      <div class="row" style="gap:8px; align-items:center; flex-wrap:wrap;">
        <div class="pill" style="background:#f3f6fb;border:none;">Owner FYI for emergencies is sent by <strong>Maintenance</strong></div>
        <div class="pill" style="background:#f3f6fb;border:none;">Handoff status: <strong>READY FOR FINANCE</strong></div>
      </div>

      <!-- Dispatch Flow -->
      <div class="card" id="maintDispatchFlow" style="margin-top:12px;">
        <h3>Maintenance Dispatch Flow</h3>
        <p class="note">Answer each question in order. The next step will appear automatically.</p>

        <!-- Q1 -->
        <div class="flowQ" id="q1">
          <label><strong>Is it an Emergency?</strong></label>
          <div class="row" style="gap:8px;">
            <button type="button" class="btn" data-next="OUT_STANDARD">Yes</button>
            <button type="button" class="btn" data-next="q2">No</button>
          </div>
        </div>

        <!-- Q2 -->
        <div class="flowQ hidden" id="q2">
          <label><strong>Is the Property in Delinquent Status?</strong></label>
          <div class="row" style="gap:8px;">
            <button type="button" class="btn" data-next="OUT_DELINQ">Yes</button>
            <button type="button" class="btn" data-next="q3">No</button>
          </div>
        </div>

        <!-- Q3 -->
        <div class="flowQ hidden" id="q3">
          <label><strong>Is the Property enrolled in a Home Warranty program?</strong></label>
          <div class="row" style="gap:8px;">
            <button type="button" class="btn" data-next="OUT_HW">Yes</button>
            <button type="button" class="btn" data-next="q4">No</button>
          </div>
        </div>

        <!-- Q4 -->
        <div class="flowQ hidden" id="q4">
          <label><strong>Will the Owner complete their own maintenance tickets?</strong></label>
          <div class="row" style="gap:8px;">
            <button type="button" class="btn" data-next="OUT_NOTIFY_OWNER">Yes</button>
            <button type="button" class="btn" data-next="q5">No</button>
          </div>
        </div>

        <!-- Q5 -->
        <div class="flowQ hidden" id="q5">
          <label><strong>Was the same issue reported within the last 12 months?</strong></label>
          <div class="row" style="gap:8px;">
            <button type="button" class="btn" data-next="OUT_RECALL">Yes</button>
            <button type="button" class="btn" data-next="OUT_STANDARD">No</button>
          </div>
        </div>

        <!-- Decision -->
        <div id="mdf_out_wrap" class="hidden" style="margin-top:10px;">
          <div class="hr"></div>
          <label><strong>Decision</strong></label>
          <textarea id="mdf_out" readonly style="min-height:110px"></textarea>
          <div class="row" style="gap:8px;margin-top:6px;">
            <button type="button" class="btn primary" id="mdf_copy">Copy Decision</button>
            <button type="button" class="btn" id="mdf_reset">Reset</button>
          </div>
        </div>
      </div>

      <!-- Work Order Details + Owner Plan -->
      <div class="two-col">
        <div class="card">
          <h3>WO Details</h3>
          <div class="field"><label>Work Order #</label><input id="wo_id" type="text" placeholder="e.g., 3425886"></div>
          <div class="field"><label>Property Address</label><input id="wo_addr" type="text" placeholder="e.g., 7418 Hindon Cir"></div>
          <div class="field"><label>Vendor</label><input id="wo_vendor" type="text" placeholder="e.g., ABC Plumbing"></div>
          <div class="field">
            <label>Owner Plan</label>
            <select id="owner_plan">
              <option value="" selected>Select...</option>
              <option>Standard- (Owner Approval >300+)</option>
              <option>Home Warranty (Owner Has An Active HW Plan with PW Auth)</option>
              <option>Basic- (Owner Approval >150+)</option>
              <option>Opt-Out (Owner Managed)</option>
              <option>Emergency-Only (Auto Approved, EPM Approved, FYI to Owner)</option>
            </select>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== Finance (placeholder) ===== -->
    <section class="card hidden" id="view-finance" data-view="finance"><h3>Finance</h3><p class="note">‚Äî</p></section>
    <section class="card hidden" id="view-nonmaint" data-view="nonmaint"><h3>Non-Maintenance Bill</h3><p class="note">‚Äî</p></section>
    <section class="card hidden" id="view-stale" data-view="stale"><h3>Stale Listing</h3><p class="note">‚Äî</p></section>

    <!-- ===== Delinquency ===== -->
    <section class="card hidden" id="view-delinquency" data-view="delinquency">
      <h3>Delinquency Details</h3>
      <div class="two-col">
        <div class="field"><label>Tenant name</label><input id="dlq_tenant" type="text"></div>
        <div class="field"><label>Address</label><input id="dlq_address" type="text"></div>
        <div class="field"><label>Rent balance</label><input id="dlq_rent" type="text"></div>
        <div class="field"><label>Utility balance</label><input id="dlq_util" type="text"></div>
        <div class="field"><label>Misc balance</label><input id="dlq_misc" type="text"></div>
        <div class="field"><label>Fees/Late Fees</label><input id="dlq_fees" type="text"></div>
        <div class="field"><label>Total balance</label><input id="dlq_total" type="text" placeholder="$0.00"></div>
        <div class="field"><label>Last payment</label><input id="dlq_lastpay" type="text"></div>
        <div class="field"><label>Last communication</label><input id="dlq_lastcomm" type="text"></div>
      </div>

      <div class="soft">
        <div class="field"><label>FTP date</label><input id="dlq_ftp" type="text" placeholder="e.g., 10/26/2025 or Not Scheduled"></div>
        <div class="field"><label>Court outcome</label><input id="dlq_court" type="text"></div>
        <div class="field"><label>Judgment ordered</label><input id="dlq_judgment" type="text"></div>
        <div class="field"><label>Eviction date</label><input id="dlq_eviction" type="text"></div>
        <div class="field"><label>Reason no eviction</label><input id="dlq_noevict_reason" type="text"></div>
        <div class="field"><label>Lease end date</label><input id="dlq_leaseend" type="text"></div>
        <div class="field"><label>Last PW action</label><input id="dlq_lastaction" type="text"></div>
      </div>

      <div class="hr"></div>
      <h3>Delinquency Contact & Email</h3>
      <div class="two-col">
        <div class="field"><label>Manager Assigned</label><input id="dlq_manager" type="text" placeholder="e.g., SYS"></div>
        <div class="field">
          <label>Voucher Tenant?</label>
          <select id="dlq_voucher"><option value="" selected>‚Äî Select ‚Äî</option><option>Yes</option><option>No</option></select>
        </div>
        <div class="field"><label>Tenant vs HAP Rent Portion</label><input id="dlq_rentportion" type="text" placeholder="e.g., N/A - Rent is $1,674 + $25 RBP"></div>
        <div class="field">
          <label>Buildium Collection Block (blocked from partial online payments?)</label>
          <select id="dlq_blocked"><option value="" selected>‚Äî Select ‚Äî</option><option>Yes</option><option>No</option></select>
        </div>
        <div class="field">
          <label>Eligible for ROR?</label>
          <select id="dlq_ror"><option value="" selected>‚Äî Select ‚Äî</option><option>Yes</option><option>No</option></select>
        </div>
      </div>

      <div class="hr"></div>
      <h3>Email Draft</h3>
      <div class="two-col">
        <div class="field"><label>To</label><input id="dlq_email_to" type="text" placeholder="owner@example.com"></div>
        <div class="field"><label>CC</label><input id="dlq_email_cc" type="text" placeholder="epm@propertywize.com"></div>
      </div>
      <div class="soft">
        <div class="field"><label>Subject</label><input id="dlq_email_subj" type="text" placeholder="Delinquency Update ‚Äì [Tenant] ([Property])"></div>
        <div class="field"><label>Preview</label><textarea id="dlq_email_body" readonly style="min-height:220px"></textarea></div>
        <div class="row" style="gap:8px;">
          <button class="btn" id="dlq_email_preview">Preview</button>
          <button class="btn primary" id="dlq_email_send">Send Email</button>
        </div>
      </div>
    </section>

    <!-- ===== Appliance ===== -->
    <section class="card hidden" id="view-appliance" data-view="appliance">
      <h3>Appliance Intake</h3>
      <div class="two-col">
        <div class="field"><label>Tenant</label><input id="appl_tenant" type="text" placeholder="(auto uses Delinquency Tenant if blank)"></div>
        <div class="field"><label>Address / Unit</label><input id="appl_address" type="text" placeholder="123 Main St, Unit 2B"><input id="appl_unit" type="text" style="margin-top:6px" placeholder="Unit"></div>
        <div class="field"><label>Appliance Type</label><input id="appl_type" type="text" placeholder="e.g., Dishwasher"></div>
        <div class="field"><label>Brand</label><input id="appl_brand" type="text" placeholder="e.g., Whirlpool"></div>
        <div class="field"><label>Model #</label><input id="appl_model" type="text" placeholder="e.g., WRS571CIHZ"></div>
        <div class="field"><label>Serial #</label><input id="appl_sn" type="text"></div>
        <div class="field"><label>Color</label><input id="appl_color" type="text"></div>
        <div class="field"><label>Age (years)</label><input id="appl_age" type="text" placeholder="e.g., 4"></div>
        <div class="field"><label>Issue (tenant complaint)</label><input id="appl_complaint" type="text" placeholder="(quote tenant)"></div>
        <div class="field"><label>Vendor</label><input id="appl_vendor" type="text" placeholder="e.g., NT Appliance - Ahmed"></div>
        <div class="field"><label>Vendor Reco</label><input id="appl_vendor_reco" type="text" placeholder="[repair/replacement] (if applicable)"></div>
        <div class="field"><label>Album Link</label><input id="appl_album" type="text" placeholder="https://..."></div>
      </div>

      <div class="hr"></div>
      <div class="two-col">
        <div class="field"><label>Troubleshooting Result</label><input id="appl_troubleshoot" type="text" placeholder="e.g., power reset done, still not heating"></div>
        <div class="field"><label>Prepared By</label><input id="appl_prepared_by" type="text" placeholder="Your Name"></div>
      </div>

      <div class="hr"></div>
      <h3>EPM Email (preview)</h3>
      <textarea id="appl_email_out" readonly></textarea>
      <div class="row" style="gap:8px;margin-top:6px;">
        <button class="btn" id="appl_copy_epm">Copy Handoff Comment</button>
      </div>

      <div class="hr"></div>
      <h3>Tenant Deferral Email (if delinquent &amp; non-essential)</h3>
      <textarea id="appl_deferral_out" readonly></textarea>
      <div class="row" style="gap:8px;margin-top:6px;">
        <button type="button" class="btn" id="appl_deferral_copy">Copy Tenant Deferral Email</button>
      </div>

      <div class="row" style="gap:8px;margin-top:12px;">
        <button class="btn primary" onclick="window.appl_generate()">Generate</button>
        <button class="btn" onclick="window.appl_clear()">Clear</button>
      </div>
    </section>

  </div><!-- /main -->
</div><!-- /container -->

<script>
/* ========= Navigation (left pills) ========= */
(function(){
  const pills=[...document.querySelectorAll('.pillnav .pill')];
  function show(view){
    document.querySelectorAll('[data-view]').forEach(s=>{
      s.classList.toggle('hidden', s.getAttribute('data-view')!==view);
      s.classList.toggle('active', s.classList.contains('pill') && s.getAttribute('data-view')===view);
    });
    document.querySelectorAll('section[id^="view-"]').forEach(sec=>{
      sec.classList.toggle('hidden', sec.id !== 'view-' + view);
    });
  }
  pills.forEach(p=>p.addEventListener('click',()=>show(p.getAttribute('data-view'))));
  show('maintenance');
  document.getElementById('btnResetAll')?.addEventListener('click',()=>location.reload());
})();

/* ========= Maintenance Dispatch Flow: single-step + decisions ========= */
(function(){
  const flow = document.getElementById('maintDispatchFlow');
  if (!flow || flow._pwBound) return;
  const $ = s => flow.querySelector(s);
  const $$ = s => Array.from(flow.querySelectorAll(s));

  const DECISIONS = {
    OUT_STANDARD: "Proceed with Standard Dispatch (send owner FYI; auto approval by EPM for emergencies).",
    OUT_DELINQ:   "Complete Delinquency SOP.",
    OUT_HW:       "Proceed with Scheduling with Home Warranty.",
    OUT_NOTIFY_OWNER: "Notify the rental owner of the request (owner completes maintenance tickets).",
    OUT_RECALL:   "Check the history and begin the Recall SOP."
  };

  const outWrap = document.getElementById('mdf_out_wrap');
  const outBox  = document.getElementById('mdf_out');

  function hideAll(){ $$('.flowQ').forEach(el=>{ el.classList.add('hidden'); el.removeAttribute('data-active'); }); }
  function show(id){ const el = document.getElementById(id); if (el){ el.classList.remove('hidden'); el.setAttribute('data-active','1'); } }
  function showDecision(code){ if(!outWrap||!outBox) return; outBox.value = DECISIONS[code] || code; outWrap.classList.remove('hidden'); }

  hideAll(); show('q1'); outWrap?.classList.add('hidden');

  flow.addEventListener('click',(e)=>{
    const btn = e.target.closest('button[data-next]'); if(!btn) return;
    const next = btn.getAttribute('data-next')||'';
    hideAll();
    if (next.startsWith('OUT_')) showDecision(next); else show(next);
  });

  document.getElementById('mdf_copy')?.addEventListener('click',()=>{ outBox.select(); document.execCommand('copy'); });
  document.getElementById('mdf_reset')?.addEventListener('click',()=>{ outWrap.classList.add('hidden'); hideAll(); show('q1'); });

  flow._pwBound = true;
})();

/* ========= Delinquency: Email builder (CRLF-safe) ========= */
(function(){
  if (window._pwDlqEmailBound) return; window._pwDlqEmailBound = true;
  const $ = id => document.getElementById(id);
  const v = id => ( $(id)?.value || '' ).trim();
  const na = x => x ? x : 'N/A';

  function buildBody(){
    const data = {
      manager:          na(v('dlq_manager')),
      voucher:          na(v('dlq_voucher')),
      rentPortion:      na(v('dlq_rentportion')),
      tenant:           na(v('dlq_tenant')),
      address:          na(v('dlq_address')),
      balance:          na(v('dlq_total')),
      lastPayment:      na(v('dlq_lastpay')),
      lastComm:         na(v('dlq_lastcomm')),
      ftpDate:          na(v('dlq_ftp')),
      courtOutcome:     na(v('dlq_court')),
      judgment:         na(v('dlq_judgment')),
      evictionDate:     na(v('dlq_eviction')),
      lastAction:       na(v('dlq_lastaction')),
      reasonNoEviction: na(v('dlq_noevict_reason')),
      leaseEnd:         na(v('dlq_leaseend')),
      blocked:          na(v('dlq_blocked')),
      ror:              na(v('dlq_ror'))
    };
    return `Manager Assigned: ${data.manager}
Voucher Tenant: ${data.voucher}
Tenant's vs HAP Rent Portion: ${data.rentPortion}
1. Tenant's Name: ${data.tenant}
2. Address: ${data.address}
3. Balance: ${data.balance}
4. Last Payment Received: ${data.lastPayment}
5. Last Communication from Tenant: ${data.lastComm}
6. FTP Date: ${data.ftpDate}
7. Court Outcome: ${data.courtOutcome}
8. Judgment Ordered: ${data.judgment}
9. Eviction Date Scheduled: ${data.evictionDate}
10. Last Action Completed: ${data.lastAction}
11. If no eviction schedule was completed, please state the reason: ${data.reasonNoEviction}
12. Lease End Date: ${data.leaseEnd}
13. Tenant status in Buildium reflects collection status, meaning they are blocked from making partial payments online: ${data.blocked}
14. Eligible for ROR? ${data.ror}`;
  }

  function defaultSubject(){
    const t = v('dlq_tenant') || 'Tenant';
    const a = v('dlq_address') || 'Property';
    return `Delinquency Update ‚Äì ${t} (${a})`;
  }

  function preview(){
    const subj = v('dlq_email_subj') || defaultSubject();
    $('dlq_email_subj').value = subj;
    $('dlq_email_body').value = buildBody();
  }

  function send(){
    const to = v('dlq_email_to'); const cc = v('dlq_email_cc');
    const subj = v('dlq_email_subj') || defaultSubject();
    let body = $('dlq_email_body').value || buildBody();
    if (!to){ alert('Please add a recipient (To).'); return; }
    // force CRLF for mobile/Outlook
    body = body.replace(/\r?\n/g, '\r\n');
    const rcpts = [to, cc].filter(Boolean).join('; ');
    window.location.href = `mailto:${encodeURIComponent(rcpts)}?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(body)}`;
  }

  $('dlq_email_preview')?.addEventListener('click', e=>{ e.preventDefault(); preview(); });
  $('dlq_email_send')?.addEventListener('click',    e=>{ e.preventDefault(); preview(); send(); });

  ['dlq_tenant','dlq_address'].forEach(id=>$(id)?.addEventListener('input',()=>{ if(!v('dlq_email_subj')) $('dlq_email_subj').placeholder = defaultSubject(); }));
})();

/* ========= Appliance: generate (deferral + EPM email) ========= */
if (typeof window.appl_generate !== 'function'){
  window.appl_generate = function(){
    const gv = id => (document.getElementById(id)?.value || '').trim();

    const addr = gv('appl_address'),
          unit = gv('appl_unit'),
          t    = gv('appl_tenant') || gv('dlq_tenant'),
          type = gv('appl_type'),
          brand= gv('appl_brand'),
          model= gv('appl_model'),
          color= gv('appl_color'),
          sn   = gv('appl_sn'),
          age  = gv('appl_age'),
          issue= gv('appl_complaint'),
          vendor=gv('appl_vendor'),
          reco = gv('appl_vendor_reco'),
          album= gv('appl_album'),
          troubleshoot = gv('appl_troubleshoot'),
          preparedBy = gv('appl_prepared_by');

    /* ---- Deferral gate (balances OVER $500 + non-essential) ‚Üí fill deferral box and return ---- */
    const num = s => { const n=(s??'').toString().replace(/[^0-9.]/g,''); return parseFloat(n)||0; };
    const balance = num(gv('dlq_total'));
    const aType = (type || '').toLowerCase().trim();
    const essentials = ['refrigerator','fridge','stove','range','oven','washer','dryer'];
    const isNonEssential = aType && !essentials.some(e=>aType.includes(e));

    let defBox = document.getElementById('appl_deferral_out');
    if (!defBox){ defBox = document.createElement('textarea'); defBox.id='appl_deferral_out'; defBox.readOnly=true; document.querySelector('#view-appliance .card')?.appendChild(defBox); }

    if (balance > 500 && isNonEssential){
      defBox.value =
`Dear ${t || 'Tenant'},

Thank you for submitting your request.

Unfortunately, we are unable to process your request at this time as your account is not in good standing. Please get in touch with our Collections Account Manager to discuss payment arrangements if necessary.

You can conveniently submit a request through your online portal at https://propertywize.managebuilding.com/Resident/public/home.

Once your account is back in good standing, please contact us to complete your request.

Regards,
PropertyWize Management Team`;
      const epmBox = document.getElementById('appl_email_out'); if (epmBox) epmBox.value = '';
      return; // stop normal EPM generation
    } else {
      defBox.value = ''; // clear deferral area if not applicable
    }

    /* ---- EPM email (per your template) ---- */
    const subject = `Appliance Ticket ‚Äì ${type || 'Appliance'} ‚Äì ${t || unit || addr || ''}`;
    const subjBox = document.getElementById('appl_subject') || document.getElementById('appl_email_subj');
    if (subjBox) subjBox.value = subject;

    const historyBlock = gv('appl_history') || `List each old ticket related to this appliance with
   = Date:
   = WO# :
   = What was repaired or replaced?
   = How much the cost`;

    const epmBody =
`Dear Shanicka/Michelle,

We have received an appliance ticket for the ${type || '[Dryer/Oven/Refrigerator/etc.]'}.

Tenant Reported:
"${issue || '[Insert tenant‚Äôs direct complaint from work order]'}"

Appliance Information:
Brand: ${brand || '[Brand Name]'}
Model#: ${model || '[Model Number]'}
Serial#: ${sn || '[Serial Number]'}
Color: ${color || '[Color]'}
Age of Appliance: ${age || '[Years/Approximate Age ‚Äì from lookup]'}
Photo Album Link: ${album || '[Insert link here ‚Äì tenant and/or vendor photos]'}

Result of troubleshooting: ${troubleshoot || '{Was troubleshooting done by the tenant:}'}

History of Appliance Repairs:
${historyBlock}

Appliance Vendor (${vendor || 'NT Appliance - Ahmed'}) has reviewed the ticket and advised ${reco || '[repair/replacement]'} (if applicable).

Based on our review, we are looking into either the same model or closest match available.

If replacement is needed, we will ensure the unit has 4.0+/5.0 rating with 500+ user reviews.

Please advise on how to proceed.

Thank you,
${preparedBy || '[Your Name]'}
`;
    const out = document.getElementById('appl_email_out');
    if (out) out.value = epmBody.trim();
  };
}

/* ========= Appliance helpers ========= */
if (typeof window.appl_clear !== 'function'){
  window.appl_clear = function(){
    ['appl_email_out','appl_deferral_out'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
  };
}
(function(){
  const c1=document.getElementById('appl_deferral_copy');
  if (c1 && !c1._pwBound){ c1.addEventListener('click',()=>{ const t=document.getElementById('appl_deferral_out'); if(!t||!t.value) return; t.select(); document.execCommand('copy'); }); c1._pwBound=true; }
  const c2=document.getElementById('appl_copy_epm');
  if (c2 && !c2._pwBound){ c2.addEventListener('click',()=>{ const t=document.getElementById('appl_email_out'); if(!t||!t.value) return; t.select(); document.execCommand('copy'); }); c2._pwBound=true; }
})();
</script>
</body>
</html>